
### 后台管理低代码开发

##### 背景
后台管理页面基本由表单和列表页组成，其中功能也大同小异，每次新增需求，业务代码重合率较大，开发时间大部分在基础功能部分重合

![技术架构图](https://github.com/twentyFive-zhang/description-mds/blob/main/images/技术架构图.png)

##### 目的
提取公共代码，开发相应的表单/列表组件，通过传入配置减少代码量，实现low-code开发，提高效率，专注业务本身，使开发时间集中在与后端接口联调，在页面开发阶段减少至少百分之六十的时间
##### 前期整合
1. 事件类型
   1. 接口事件 ——主要为与后端接口联调，获取及传递数据
   2. 用户交互事件 —— 用户点击视图后进行操作，主要按钮栏点击事件
      1. 去进行接口调用
      2. 显示弹框/确认框等
      3. 路由跳转
      4. 自定义事件
   3. 回调事件
      1. 接口调用相关，参数回调规整（入参和出参）
      2. 路由跳转前，路由参数回调规整
      3. 弹框显隐事件回调，eg.是否需要刷新列表数据
2. UI渲染
   1. SearchForm表单 （包括列表页的搜索栏/弹框表单 以及表单页面的主题表单）
   2. Table表格（列表页主要内容）
   3. ButtonLine 按钮栏 （包括列表页的操作栏及表格的操作列，用户操作主要模块）
##### 开发阶段
######	基础组件搭建（通过低代码配置）
1. SingleForm 组件  

   ![未命名文件 (1)的副本](https://github.com/twentyFive-zhang/description-mds/blob/main/images/%E6%9C%AA%E5%91%BD%E5%90%8D%E6%96%87%E4%BB%B6%20(1).png)

2. SingleTable 组件

   ![未命名文件 (2)](https://github.com/twentyFive-zhang/description-mds/blob/main/images/未命名文件%20(2).png)
######	传入配置设置
1. ajaxJson 接口相关配置 
   1. 接口函数 Promise   `AjaxKey: new Promise((resolve)=>{return resolve()})`
   2. 接口入参回调函数  ` sortAjaxKeyData:()=>{}`
   3. 接口出参回调函数  ` sortAjaxKeyAfterData:()=>{}`
2. ButtonLine 按钮栏的配置
   1. 基础配置，与ant相同，可传入覆盖
   2. `isTo...`  点击事件进行操作，先后顺序如下
      1. Modal 是否显示弹框，控制弹框显隐
      2. Confirm 是否显示确认栏，点击确认后会继续下面循环
      3. Path 是否路由跳转
      4. Ajax 是否去进行接口调用
      5. BtnClick 是否进行自定义事件绑定，支持传入一个` function`调用
3. 表单页面的props
   1. FormProps 一些表单的基础设置，布局配置/表单
   2. ajaxJson 接口配置
   3. FormJson 表单配置数据
      1. eg. ` {key:{type:'类型',label:'表单项名称',required:true}}`
      2. 如是Select/Cascader 等需要配置Options的表单项，支持传入 ` {fetchOptions:{ajax,sortParams,sortData}}` 数据，使表单项生成时调用接口回填Options
4. 列表页面的 TableProps
   1. 基础配置，全部支持ant design Table的属性，并根据其事件进行属性和事件的整合
   2. ajaxJson 接口配置
   3. columns 配置
      1. operationColumnsProps 操作栏的配置
      2. tableButtons 操作栏的按钮列表 如上ButtonLine
      3. columns 列表项数据，配置与ant相同
######	开发类型为Class类组件开发

1. 优点: 继承`extends`相对简单，生命周期/data数据/方法和组件共用，减少父子之间通信的复杂度
2. 缺点：不如FC组件开发直观

##### 组件实践
######	新专题模版开发
1.	复杂的编辑页面，有页面配置表单和多个组件表单，无需根据不同的表单数据一条一条写UI，使数据配置和UI抽离，提高配置可读性，后续修改也可直接在配置json修改

   1. 页面设置

      eg: `{
      	name: '页面设置',
      	formProps: { props: { colon: false, labelAlign: 'left' } },
      	formJson: {
          title: {
            label: '专题标题',
            type: 'input',
            props: {
              maxLength: 20,
              placeholder: '请输入专题标题,限20字内',
            },
            formItemProps: {
              required: true,
            },
          },
      }`

   2. 每个组件设置（图片/文本/课程包/课程讲/视频/FM等）都对应一个相应Json

2.	数据结构自上而下，基于`ant form`的配置，每个表单修改都会自动修改至页面层面，不用手动选择数据来源，提高容错率

​	总结: 在表单组件基础上开发，减少近百分之八十的表单页面开始时间，使开发时间聚焦在复杂交互和数据修改上，最后在三期开发时提前提测，并bug数量明显少于一二期

######	E网通搜索优化

1. 主要在列表组件上开发，代码完全没有UI代码，Compoennt里只需传入json，直接生成列表页面，代码量减少百分之六十，页面结构一目了然

2. 在编辑页面，通过抽离通用表单项组件，自定义放入formJsonItem，提高开发效率，通用性进一步提高

​	总结: 根据后台提供的yapi的接口文档，写好相应配置后，等后台接口联调，无需mock数据，可直接同步联调，提高反馈后端接口情况效率，联调时间大大缩短

######	App动态化可视化配置
1. 根据专题模版的实践，在系分阶段减少对于表单的思考时间，并在其基础上优化组件配置，将class类组件转换为FC组件，扩展兼容性，覆盖面进一步提高


##### 结论
优点:	
1.	表单/列表组件在上述需求服务后，体现了可扩展性，可提供多种复杂业务的基础建设

缺点： 
1.	表单组件基本引入了全部ant的数据录入组件，导致form组件打包后js size偏大，在大型项目中该大小可能在总体中还可以接受，但始终还是有缺陷，后续需要改成按需引入

后续优化方向
1.	可将组件打包成npm插件，项目只需 ` yarn add`,不需要每个项目建相应组件文件
2.	可根据yapi数据接口文档直接生成页面代码，类似App动态化生成Xml字符串





1. 在开发前期进行调研，与产品沟通后及时拿出demo，能使大家更好了解产品原型；与交互设计师就交互设计在demo基础上进行沟通，能使代码开发和用户体验可以同步进行，有效减少后期交互问题冲突

2. 在开发阶段进行代码整理，抽取公用代码，编写公用组件，通过传入配置渲染页面，提高开发效率和降低后期维护成本，为后续开发提供模版

3. 在开发后期优化代码逻辑，根据功能抽取代码形成各自模块，降低代码耦合度，在后期修改bug期可以快速定位错误所做，提高修改速度

4. 按时完成项目需求，在专题三期进行提前提测，并在每次需求完成后优化表单/列表组件，为下次开发提高效率



1. 小程序埋点在前期确定需求后，进行调研，确定技术选型，并查阅文档确定官方插件进行开发; 
2. 小程序埋点开发结束后进行自测结束后，及时修改bug，进行小程序插件发版后与周培优小程序进行联调，实现兼容Taro框架和原生小程序，后期测试发版后没有bug出现
3. 在之前需求开发时，沉淀出的公用表单组件，后续开发时使用可以提高开发效率，减少UI代码
3. 


1. 后台管理通用列表和表单页面的公用代码抽离，形成相应表单，通过传入配置，支持low-code开发，包含大多业务需求，并支持复杂需求开发，提高开发效率和减少UI渲染代码，能将大部分开发时间用于和后台联调接口，使后台管理页面开发更加纯粹





